# スパイク時系列間の距離 (2017/04/27)

## 説明

* 上ノ原くんからラスタープロット間の距離の計算法を尋ねられた。NNの応答の再現性を見たいらしいので、NNの同じニューロンのトライアル間でのスパイク時系列の距離を計算できれば良い。

* 編集距離 (Victor and Purpura, 1996) が有名だが、計算時間がかかる。

* 累積分布を使った手法 (Iwayama, Hirata, Aihara, 2017) が高速。

* 元論文はマーク付き点過程の一般的な場合について書かれていて正直読みづらいので、ただのスパイク時系列バージョンを以下に載せる。

## 式

* 比べたいスパイクタイミングのデータ (長さは$T$とする)
    $$\begin{align}
    X &= \{x_1, x_2, \ldots, x_N\},\\
    Y &= \{y_1, y_2, \ldots, y_M\}.\\
    \end{align}$$

* 累積分布 (NとMが異なる場合があるので、上がるバージョンと下がるバージョンの両方考える)
    $$\begin{align}
    F_X^1(v) &= |\{x\in X\mid v > x\}|,\\
    F_X^{-1}(v) &= |\{x\in X\mid v < x\}|,\\
    F_Y^1(v) &= |\{y\in Y\mid v > y\}|,\\
    F_Y^{-1}(v) &= |\{y\in Y\mid v < y\}|.\\
    \end{align}$$

* 距離 
    $$\begin{align}
    D(X,Y) &= \sqrt{\int_0^T(F_X^1(v)-F_Y^1(v))^2 dv + \int_0^T(F_X^{-1}(v)-F_Y^{-1}(v))^2 dv},\\
    &= \sqrt{\sum_{n=1}^N\sum_{n'=1}^N(T-|x_n-x_{n'}|)+\sum_{m=1}^M\sum_{m'=1}^M(T-|y_m-y_{m'}|)-2\sum_{n=1}^N\sum_{m=1}^M(T-|x_n-y_m|)}.
    \end{align}$$
